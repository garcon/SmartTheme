#!/bin/sh
# Pre-commit hook: update SmartTheme.ps1.sha256 automatically before commit
# This hook is tolerant: if PowerShell isn't available or the update fails,
# it will warn but still allow the commit to proceed.

if command -v pwsh >/dev/null 2>&1; then
  # Use a dedicated PowerShell script to avoid quoting issues in shell
  pwsh -NoProfile -ExecutionPolicy Bypass -File ".githooks/update-checksum.ps1"
  rc=$?
  if [ $rc -eq 0 ]; then
    exit 0
  else
    echo "Pre-commit: checksum update failed (exit code: $rc); allowing commit (please update SmartTheme.ps1.sha256 manually)." >&2
    exit 0
  fi
else
  echo "Pre-commit: pwsh (PowerShell) not found on PATH; cannot update checksum. Continuing commit." >&2
  exit 0
fi
